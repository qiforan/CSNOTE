# C++ Primer 笔记

## 函数

### 数组作为参数

数组有两个特殊的性质：

1. 不允许拷贝数组
2. 数组使用时会将其转换为指针


当我们为一个函数传递数组时，实际上传递的是指向数组首元素的指针。

```c++
void print(const int*)
void print(const int[]);
void print(const int[10]);
```

这三个函数是等价的：形参都是 `const int *`。

#### 常见传递数组参数有三种方式：

##### 使用标记指定数组长度

典型代表是 C 风格字符串。

##### 使用标准库规范

传递指向数组 **首元素** 和 **尾后元素** 的指针。

##### 显式传递一个表示数组大小的形参

#### 数组形参与 `const`

为数组参数添加 `const` 后不能在函数里修改数组元素值

```c++
void fun(const int * a)
{
	a[0] = 1; // error, read only
}
```

**TIP:** 当函数确实要修改数组元素值，才应该把形参设置为非常量的指针。

#### 数组引用形参 

形参可以是数组引用，此时数组大小成为数组类型的一部分，不会退化成指针。

```c++
void fun(int (&arr) [10]); // &arr 两端的括号不可少，因为下标操作符具有更高的优先级
```

`fun` 函数被限制只接受指定大小为 10 的数组。

#### 传递多维数组

多维数组实质上是数组的数组。当传递多维数组给函数时，实际上传递是一个指向数组的指针。数组的第二维的大小是数组类型一部分，不可忽略。

```c++
// m 指向数组的首元素，该数组的元素是由 10 个整数构成的数组
void fun(int (*m)[10]); // 包裹 *m 的括号同样不可忽略
```

### 可变形参

TODO

### 返回值

`void` 函数可以没有 `return` 语句，也可以使用 `return;` 结束函数。

>当需要提前结束函数时，可以使用 `return` 语句。

`void` 函数可以 `return` 另外一个 `void` 函数。

如果有返回值的函数结束时没有提供 `return` 语句，则行为是 **未定义** 的。

**注意：** 不要返回局部变量的指针或引用，因为函数结束会释放局部变量。

### 引用返回左值

调用一个返回引用的函数得到左值，否则得到右值。

返回左值的函数可以出现在等式左边。

```cpp
char &fun();
fun() = 'a'; // 合法
```

### 列表初始化返回值

C++11 规定，函数可以返回花括号包围的列表。

```cpp
vector<string> process()
{
	if(...)
		return {};
	else if(....)
		return {"a","b"};
	else 
		return {"a","b","c"};
}
```

如果返回的是内置类型，则花括号最多包裹一个值，且该值所占空间不大于目标类型的空间；

如果返回的是类类型，则由类决定初始值(花括号里的列表)如何使用。

### main 函数可以没有 `return` 语句

### 数组作为返回值

#### 返回数组指针

函数可以返回数组的指针或引用。使用 **类型别名** 可以简化做法。

```cpp
typedef int arrT[10]; // arrT类型 表示长度为 10 的数组
using arrT = int[10]; // 上面的等价声明
arrT* func(int i);    // 返回一个指向含有 10 个整数的数组的指针
```

返回数组指针的函数形式如下：

```cpp
Type (* function(params_list)) [dimension]
```

#### 使用尾置返回类型

C++11 规定可以使用 **尾置返回类型(trailing return type)**，简化复杂返回值的函数。

```cpp
// 函数返回一个指针，该指针指向长度为10的整数数组
auto fun(int i) -> int(*)[10];
```

#### `decltype`

`decltype` 可以让你获得编译期就能知道的类型。

```cpp
int odd[] = {2,4,6,8};
int even[] = {1,3,5,7};
decltype(even) *fun(int i)
{
	return (i % 2) ? &odd : &even;
}
```
