[#](#) vim 笔记

## 基础

[###](###) 发展概述

* `vi` 是 `*nix` 操作系统下最基本的文本编辑器，伯克利大学的 Bill Joy 研究开发

* `vim` 由 Bram Moolenaar 研发，开始是 vi 模拟器，即 Vi Imitation，后面被移植到了 Unix 和 Dos 上，重命名为 Vi Improved

* `gvim` 是 vim 的图形前端，是跨平台的编辑器

### 基本模式

* Normal 模式， 启动 vim 时就工作于 Normal 模式，输入被当做命令，主要功能就是控制屏幕光标的移动、进行文本的删除、复制等文字编辑工作

* Insert 模式, 在光标处插入文本

* Lastline 模式(命令模式)，主要用于保存文件或者退出 vim，也可以设置编辑环境和一些编译工作，比如列出行号、查找字符串等

## 常用命令

### 移动

在 Normal 模式和 Insert 模式下，可使用上下左右移动光标。

以下介绍 **Normal 模式** 下其他移动光标的命令

#### 行内移动

* `h` 表示向左移动光标，`j` 表示向下移动光标，`k` 表示向右移动光标，`l` 表示向右移动光标

* `$` 命令移动光标到 **行尾** ，`g_` 命令移动到当前行的最后一个 **非空字符**

* `^` 命令将光标移动到当前行第一个 **非空字符**, `0` 则是移动到当前行的 **行首**

* `+` 向 **下** 移动到行首非空字符，`-` 向 **上** 移动到行首非空字符

| 命令 | 光标动作 |
|----|----|
| `w` | 正向移动到下一单词的开头|
| `b` | 反向移动到当前单词/上一单词的开头|
| `e` | 正向移动到当前单词/下一单词的结尾|
| `ge`| 反向移动到上一单词的结尾|

![单词移动效果图](../../image/vim-move-word.png)

***

vim 区分 `word` 与 `WORD`,使用小写的 `w,b,e,ge`进行 **word** 间跳转，后者使用大写的字母进行跳转

* A WORD is always delimited by whitespace.

* A word is delimited by non-keyword characters, which are configurable. Whitespace characters aren't keywords, and usually other characters (like ()[],-) aren't, neither. Therefore, a word usually is smaller than a WORD; the word-navigation is more fine-grained.

#### 行间移动

* `gg` 跳转第一行行首，`G` 跳转尾行行首，`行号G` 跳转到该行号对应行的行首

* `:<line-num>` 行命令跳转对应行的行首

* `50%` 跳转文件中间位置，也可以使用其他数字

屏幕位置固定，移动光标

* `H` - Head 移动到屏幕的顶端
* `M` - Middle 移动到屏幕的中间
* `L` - Low 移动到屏幕的底部

然后让光标固定，移动屏幕的相对位置
* `z t` - top
* `z z` - 光标在屏幕中间
* `z b` - bottom

移动段落

* `{` 向前
* `}` 向后

移动句子

* `(` 向前
* `)` 向后

***

vim 区分 **实际行** 和 **屏幕行** ，文件按照换行符分割实际行，按照屏幕宽度和换行符分割屏幕行，对屏幕行操作需要在对应操作前加上 `g`，例如 `gj` 和 `gk` 则是按屏幕行向下及向上移动。

##### 标记

可以使用标注功能来标记一个位置。

* 定义当前文件中的标注，可以先按下 `m` 再按下标注名。比如，按下 `mm` 就可以把当前位置标注为 `m`。在这之后，只需要通过 `'m` 或者 `` `m`` 即可回到刚才标注的行。区别在于，`'m`会跳转回被标记行的行首的**非空字符**，而`` `m ``会跳转回标记。

标记名若为小写字母，仅在当前文件生效；若为大写字母，则为全局的标注。

**更多标记**

* `''` 是上次跳转操作光标所在的位置
* `'"` 是上次退出当前文件的位置
* `'[` 是上次编辑（删除修改等）的开始位置
* `']` 是上次编辑（删除修改等）的结束位置
* `'.` 是上次编辑（删除修改等）的最后的操作位置

使用 `:marks` 命令来显示所有的标注，`:delm <mark>` 删除标记

jump list 记录跳转位置，使用 `:ju[mps]` 打印跳转列表

* `ctrl + o` - 跳转到 jump list 上一位置
* `ctrl + i` - 跳转到 jump list 下一位置


### 搜索

#### 字符搜索

* `f` 接字符表示在**当前行**右向搜索，`F` 则是左向搜索

* 查找下一个 `；`, 返回上一个 `,`

* `t` 与 `f` 含义类似，区别是光标停留在被搜索字符的前一个位置

* `%` 搜索与当前光标停留的括号相匹配的另一个括号的位置，并跳转

#### 文本搜索

* `/` 接字符串表示搜索字符串在文档的位置，若要搜索单词，则 `/\<word\>`，`\<` 表示匹配一个单词的开头，而 `\>` 则表示匹配一个单词的结束

* `?` 反向

* `/` 命令是可以使用正则, 使用 `n` 搜索下一个, `N` 搜索上一个

#### 查找单词

如果在一个单词上面的时候按下 `*` 就是查找当前光标所在的单词，`#` 则是反向查找。

### 操作文本内容

常见的操作

* `d` 是 delete 的首字母，后跟一个位移命令，将删除从当前光标起点到位移的终点处的文本内容

* `c` 与 `d` 类似，区别在于执行完成后进入 Insert 模式

* `x` 命令删除当前光标的字符, 可以理解为 `dl`, `X`删除光标前一个字符，即 `dh`

* `D` 表示删除到行尾，即 `d$`

* `s` 表示删除当前字符并进入 Insert 模式，即`cl`

* `r` 命令后面接一个字符，表示用该字符替换当前字符

* `R` 进入替换模式

* `dd` 表示删除当前行

此类命令有一个固定的模式：操作符命令 + 位移命令，位移命令为上节所述

#### i/a

`i/a` 可以删除一块内容。例如，`ci"` 删除光标所在的双引号包含的内容，`ca"` 删除光标所在双引号包含的内容，包括双引号。
可 `i` 和 `a` 的文字块
* w word 小词
* W Word 大词
* s sentence 句子
* p paragraph 段落
* ( 、) 小括号
* [ 、] 中括号
* { 、} 大括号
* t tag 标签
* "、' 引号

### 重复操作

使用`.`命令重复上次操作

### 常用编辑命令

Normal 模式下删除的文本被保存下来了, 但不是保存到Windows的剪贴板

`p` 命令表示粘贴，`y`表示复制

如果被保存的是整行，则粘贴到下一行，否则从光标后面位置粘贴

`P` 命令与 `p` 相似，区别是粘贴位置在光标前或上一行

`np` 表示粘贴n次

`y4w` 表示复制4个 word ,如果不想复制空白，则 `y4e`

### visual 模式

在 Normal 模式键入 `v` 进入 visual 模式，即可视模式

`hjkl`、`g`命令表示光标移动的命令在这里都是可用的

### 文本对象

`aw` 表示一个文本对象，`daw` 删除光标所在单词和后面的空格， `diw`不删除后面空格
`as` 表示一个句子对象，`das` 删除光标所在句子和后面的空格， `dis`不删除后面空格

## 最常用的一些操作

### Lastline 模式下常见操作

* :e filename 打开编辑一个文件
* :w filename 保存文件
* :sav filename 另存为
* :enew  新建
* :set filetype= 设置文件类型
* :set background= 设置背景色
* :split 分割窗口 :vsplit 水平分割
* `:only` 关闭其他窗口
* `:set number` 显示行号， `:unset nonumber` 取消显示行号

## 宏

寄存器录制宏

* 输入 `q{寄存器}` 开始录制，寄存器名为a至z的一个字母

* 执行操作

* 输入 `q` 结束录制

使用宏 `n@x`，其中n表示重复次数，x表示存放宏的寄存器

输出宏命令内容 `"xp`，其中x是宏所在寄存器

### 寄存器
我们平时用的都是无名寄存器，其实有很多种寄存器的

* 无名寄存器`""`
* 数字寄存器`"0-"9`
* 行内删除专用寄存器`"-`
* 指定寄存器 `"a-"z、"A-"Z`
* 3个只读寄存器 `":、".、"%`
  * `".` 里面存储着上次插入的内容
  * `"%` 里面存储着当前文件的名字
  * `":` 里面存储着刚刚执行的命令
* 轮换文件寄存器 `"#`
* 表达式寄存器 `"=`
* 选择和拖拽寄存器 `"*、"+、"~`
* 黑洞寄存器 `"-`
* 搜索模式寄存器 `"/`

#### 无名寄存器 `""`

`d、x` 删除内容、`y` 复制内容、`p` 粘贴使用的默认寄存器。

插入模式下按 `ctrl+r`，状态栏cmd区域会出现 `^R`，然后按下默认寄存器对应的 `"` 就可以了。

#### 数字寄存器 `"0-"9`

`"0` 中存储的是最近yank的内容，`"1-"9` 中存储的是最近删除的内容，1 为最新，9 为最旧。

### 查找和替换

批量的查找和替换: `:s/查找字符/替换字符/[可选的修饰符]`

可选的修饰符，常用的有：g 表示替换该行所有的符合的目标字符串， p 表示列印， c 表示每次执行替换的时候都需要请求确认

默认查找光标所在行，可以在命令前添加 `行号、%、$`来更改查找范围

* `.` 表示当前行
* `%` 表示每一行
* `$` 表示最后一行
* 范围之间用`,`分割

举例：

```shell
:s/查找内容/替换内容/    #默认查找光标所在行，并替换该行第一次匹配到的内容  
:%s/查找内容/替换内容/   #则查找的是全部行，  
:$s/查找内容/替换内容/   #查找最后一行  
:5s/查找内容/替换内容/   #查找第五行  
:5,$s/查找内容/替换内容/  #查找第五行到最后一行  
```

更多可参考[博客](https://www.cnblogs.com/logsharing/p/8182920.html)

### 全局命令

`:g` 命令是全局命令，允许我们找到某个匹配模式的行然后将命令作用到它上面

```shell
:[范围参数]g/{模式}/{可执行的 vim 命令}
```

